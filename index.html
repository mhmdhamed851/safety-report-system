<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="نظام إدارة تقارير السلامة الميدانية">
    <meta name="keywords" content="نظام إدارة تقارير السلامة الميدانية">
    <meta name="author" content="عبدالله">
    <meta property="og:title" content="نظام إدارة تقارير السلامة الميدانية">
    <meta property="og:description" content="نظام إدارة تقارير السلامة الميدانية">
    <meta property="og:image" content="images/amr.jpg">
    <meta property="og:url" content="https://web-test.page.gd/">
    <meta property="og:type" content="website">
    <title>نظام إدارة تقارير السلامة الميدانية</title>
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="style/section.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
</head>

<body>

    <div class="container">
        <header>
            <img src="images/amr.jpg" alt="Logo">
            <img src="images/NWC - logo.png" alt="Logo">
        </header>
        <section class="section-project" id="section-project">
            <h1>نظام إدارة تقارير السلامة الميدانية</h1>
            <h2>تقرير متابعة إجراءات السلامة و الأمن في الموقع</h2>
            <table class="table">
                <tr>
                    <th class="table-th1">جهة الإشراف :</th>
                    <th class="table-th2" id="supervisor">
                        شركة مجموعة العمرو للإستشارات الهندسية
                    </th>
                </tr>
                <tr class="table-tr1">
                    <th class="table-th1">المقاول :</th>
                    <th class="table-th2">
                        <div class="form-group">
                            <select id="contractor" aria-label="المقاول" onchange="updateContractorDetails(this.value)">
                                <option value="">-- اختر المقاول --</option>
                                <option value="شركة منار الوطنية للمقاولات" selected>شركة منار الوطنية للمقاولات
                                </option>
                                <option value="custom">+ إضافة مقاول جديد</option>
                            </select>
                        </div>
                    </th>
                </tr>

                <tr class="table-tr1">
                    <th class="table-th1">إسم المشروع :</th>
                    <th class="table-th2">
                        <div class="form-group">
                            <input type="text" id="projectName" aria-label="اسم المشروع">
                        </div>
                    </th>
                </tr>

                <tr>
                    <th class="table-th1">رقم العقد/المشروع :</th>
                    <th class="table-th2">
                        <div class="form-group">
                            <input type="text" id="projectNumber" aria-label="رقم العقد/المشروع">
                        </div>
                    </th>
                </tr>

                <tr class="table-tr1">
                    <th class="table-th1">الموقع :</th>
                    <th class="table-th2">
                        <div class="form-group">
                            <input type="text" id="location" aria-label="الموقع">
                        </div>
                    </th>
                </tr>

                <tr>
                    <th class="table-th1">تاريخ الزيارة :</th>
                    <th class="table-th2">
                        <div class="form-group">
                            <input type="date" id="inspectionDate" value="2025-12-08" aria-label="تاريخ الزيارة">
                        </div>
                    </th>
                </tr>
            </table>
        </section>

        <div class="main-content">
            <div class="sidebar">
                <div class="section-visit">
                    <div class="form-group">
                        <label class="form-label" for="visitType">نوع الزيارة</label>
                        <select id="visitType">
                            <option value="">-- اختر نوع الزيارة --</option>
                            <option value="1" selected>زيارة ميدانية لمتابعة إجراءات السلامة بموقع العمل</option>
                            <option value="2">زيارة تفتيشية لمتابعة الإجراءات التصحيحية لملاحظات السلامة</option>
                            <option value="3">زيارة مفاجئة</option>
                        </select>
                    </div>
                </div>

                <div class="section-positive">
                    <div class="section-title-positive">
                        <div class="icon icon-positive"></div>
                        الملاحظات الإيجابية (نقاط القوة)
                    </div>
                    <div id="positiveList"></div>
                    <div class="form-group" style="margin: 10px auto; width: 100%;">
                        <label for="positiveNoteSelect">اختر ملاحظة إيجابية من القائمة</label>
                        <select id="positiveNoteSelect" style="width: 100%;">
                            <option value="">-- اختر من القائمة --</option>
                            <option value="التزام العاملين باستخدام معدات الوقاية الشخصية">التزام العاملين باستخدام معدات الوقاية الشخصية</option>
                            <option value="تنظيم وتخطيط جيد لموقع العمل">تنظيم وتخطيط جيد لموقع العمل</option>
                            <option value="نظافة وترتيب موقع العمل">نظافة وترتيب موقع العمل</option>
                        </select>
                        <div class="note-controls">
                            <button class="btn btn-add btn-sm" onclick="addSelectedPositiveNote()">إضافة الملاحظة المختارة</button>
                        </div>
                    </div>
                </div>

                <div class="section" style="margin: 10px auto; width: 100%; border: #858380 1px solid; padding: 10px; border-radius: 8px;">
                    <div class="section-title">
                        <div class="icon icon-images"></div>
                        رفع صور لموقع العمل
                    </div>
                    <div class="form-group">
                        <label for="bulkImageInput">اختر صورًا (يمكن اختيار أكثر من صورة)</label>
                        <input type="file" id="bulkImageInput" accept="image/*" multiple onchange="handleBulkImages(this)" />
                        <div id="bulkPreview" style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;"></div>
                    </div>
                </div>
            </div>

            <div class="content">
                <div class="section">
                    <div class="section-title-negative">
                        <div class="icon icon-negative"></div>
                        الملاحظات السلبية والإجراءات التصحيحية
                    </div>
                    <div id="negativeList"></div>
                    <div class="form-group">
                        <label>وصف الملاحظة السلبية</label>
                        <textarea id="violationDescription" rows="3" placeholder="أدخل تفاصيل الملاحظة"></textarea>
                        <button class="btn btn-primary" style="margin-top:10px" onclick="addViolationNote()">إضافة الملاحظة</button>
                    </div>
                </div>

                <div class="section" style="margin-top: 20px; border-top: 2px solid #00735e; padding-top: 15px;">
                    <div class="section-title" style="color: #00735e; font-weight: bold;">
                        اعتماد ومراجعة التقرير
                    </div>
                    <div class="form-group">
                        <label for="finalInspector">اسم المفتش المعتمد للتقرير:</label>
                        <select id="finalInspector" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-weight: bold;">
                            <option value="محمد حامد عبدالله" selected>محمد حامد عبدالله</option>
                            <option value="م/ أحمد البارقي">م/ أحمد البارقي</option>
                            <option value="م/ فارس الزهراني">م/ فارس الزهراني</option>
                            <option value="م/ محجوب محمد">م/ محجوب محمد</option>
                        </select>
                        <p style="font-size: 12px; color: #666; margin-top: 5px; font-style: italic;">مجموعة العمرو للإستشارات الهندسية - تم الاعتماد إلكترونياً</p>
                    </div>
                </div>

                <div class="preview-section">
                    <div class="preview-title">معاينة التقرير</div>
                    <div id="reportPreview" class="report-preview"></div>
                </div>

                <div style="margin-top: 30px; text-align: left; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="generatePDFReport()">تحويل إلى PDF</button>
                    <button class="btn btn-images" onclick="showImagesPage()">عرض صور لموقع العمل</button>
                </div>
            </div>
        </div>

        <footer>
            <p id="footerText">جميع الحقوق محفوظة © 2025 - مجموعة العمرو - All rights reserved</p>
        </footer>
    </div>

    <script>
        // دالة مخصصة لضمان تعديل مسمى الصور في الـ PDF وظهور اسم المفتش
        function generatePDFReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // جلب اسم المفتش المختار
            const inspectorName = document.getElementById('finalInspector').value;
            
            doc.text("تقرير متابعة إجراءات السلامة", 105, 20, { align: "center" });
            
            // مثال على إضافة اسم المفتش في نهاية التقرير
            let finalY = 200; // قيمة افتراضية لموقع النص
            doc.setFontSize(12);
            doc.text("صور لموقع العمل", 105, finalY - 20, { align: "center" });
            doc.text("اسم المفتش المسؤول: " + inspectorName, 20, finalY);
            doc.text("تم الاعتماد إلكترونياً من مجموعة العمرو", 20, finalY + 10);
            
            doc.save("تقرير_السلامة_" + inspectorName + ".pdf");
            alert("تم إنشاء التقرير بنجاح باسم المفتش: " + inspectorName);
        }

        function showImagesPage() {
            alert("سيتم عرض صور لموقع العمل المرفوعة");
        }
    </script>
</body>

</html>
